!!!
%html
  %head
    %meta{:content => 'text/html; charset=utf-8', 'http-equiv' => 'Content-type'}/
    %title= website_title_with_app_name

    = stylesheet_link_tag    'bootstrap_setup', :media => 'all'
    = stylesheet_link_tag    'wingolf_layout', :media => 'all'
    = stylesheet_link_tag    'application', :media => 'all'

    = favicon_link_tag 'favicon.ico'
    = favicon_link_tag 'fahne-144x144.png', rel: 'apple-touch-icon', type: 'image/png'
    
    %link{rel: 'search', href: opensearch_path, title: "Wingolfsplattform-Suche", type: 'application/opensearchdescription+xml'}
    
    = javascript_include_tag 'application'
    = gmaps4rails_api_script_tags
    = csrf_meta_tags
    = yield :head
  %body{:class => controller.controller_name, data: {locale: I18n.locale, navable: @navable.try(:to_global_id)}}
    - if user_account_signed_in?
      - Rack::MiniProfiler.step("#logged-in-bar") do
        #logged-in-bar
          #backendBar
            .content
              %ul.backendBarItems
                %li.first.backendBarItem.dropdown
                  %span.user_avatar
                    = render 'layouts/session_bar_avatar'
                  %span.user_name#user_name{data: {email: current_user.email, id: current_user.id, title: current_user.title}}
                    = link_to current_user.title, main_app.user_path( current_user )
                    - if show_merit_indicators?
                      = link_to merit_indicator(current_user), user_badges_path(current_user)
                  %b.caret
                  %ul.dropdown-menu
                    %li= link_to t(:my_profile), current_user
                    %li= link_to t(:change_avatar), user_path(current_user, trigger_change_avatar: true)
                    %li= link_to t(:change_password), change_password_path
                    %li= link_to t(:sign_out), sign_out_path
                %li.backendBarItem
                  = link_to t(:my_profile), current_user, :class => 'my_profile'
                %li.backendBarItem.dropdown
                  -# link_to t( :my_groups ), main_app.my_groups_path, class: 'dropdown-toggle', data: { toggle: 'dropdown' }
                  = link_to my_groups_path, class: 'dropdown-toggle' do
                    = t :my_groups
                    %b.caret
                  %ul.dropdown-menu
                    = cached_groups_of_user_table current_user
                
                - # role indicator and preview menu
                = render partial: 'layouts/role_preview_switcher'
                
                = render partial: 'notifications/notifications_dropdown'
                
                - # %li.backendBarItem.dropdown
                - #   = link_to t(:bookmarks), my_bookmarks_path
                - #   %ul.dropdown-menu.my-favorites
                - #     = bookmarked_objects_lis( current_user )
                %li.last.backendBarItem
                  = link_to t( :logout ), main_app.destroy_user_account_session_path, method: :delete
            .clear
    - Rack::MiniProfiler.step("#header-bar") do
      #header-bar
        #headerBg
          #header
            #header_claim
              = image_tag( 'claim.png' )
            #header_logo
              = link_to( image_tag( 'logo.png' ), root_path )
              - if current_user.try(:beta_tester?)
                = link_to group_path(Group.find_by_flag(:beta_testers)) do
                  %span.badge.beta_badge.has_tooltip{title: "Du hast Zugriff auf Funktionen, die sich in der Erprobungsphase befinden.", data: {placement: 'right'}} +Beta
            #header_help
              = render partial: 'support_requests/help_button'
            #header_search
              = render partial: 'shared/search_box'
            %span#category_indicator
              - Rack::MiniProfiler.step("#horizontal_nav") do
                #horizontal_nav= horizontal_nav
    #contentBgLayer1
      #contentBgLayer2
        #contentBgLayer3
          #content_wrapper
            #toolbar
              - # %span#star_tool
              - #   = star_tool( current_user, @navable )
              %span#breadcrumb
                = breadcrumb_ul
              %span#access_indicator
                = access_indicator if current_user
            %span#content_area
            - Rack::MiniProfiler.step("#content") do
              #content
                - if show_vertical_nav?
                  .content_twoCols.content_twoCols-20-80
                    .content_twoCols_left
                      = vertical_nav
                      = render partial: 'last_seen_activities/index'
                    .content_twoCols_right
                      #flash{data: {'turbolinks-temporary' => true}}= flash_area
                      = render partial: 'shared/read_only_mode_notice' if read_only_mode?
                      = replace_unicode_special_chars_by_html_escape_strings( |
                          convert_to_content_box { yield }                    |
                        )                                                     |
                    \Â 
                - else
                  = flash_area
                  = replace_unicode_special_chars_by_html_escape_strings( |
                      convert_to_content_box { yield }                    |
                    )                                                     |
                .clear
    = render partial: 'layouts/footer'
    = debug(params) if Rails.env.development?
    = yield :scripts
